<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Rockhurst Sample Project for Greg</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="robots" content="noarchive">
<meta name="hdl" content="">
<meta name="lp" content="A comparison of user statements on STEM before and after teh conference.">
<meta name="dat" content="September 7, 2012">
<meta name="DISPLAYDATE" content="September 7, 2012">
<meta name="pdate" content="20120907">
<meta name="col" content="">
<meta name="dsk" content="U.S. / Politics">
<meta name="cre" content="By Greg Owsley, Wiliam Palin and I guess DJ jk jk ?">
	
<meta name="tom" content="interactive_feature">
<meta name="display-text" content="Interactive Feature">
<meta name="display-name" content="interactive">
<meta name="url_thumb" content="/images/2012/09/06/us/politics/75.png">
<meta name="url_thumb_wide" content="/images/2012/09/06/us/politics/190.png">
<meta name="ttl" content="">
<meta name="des" content="Presidential Election of 2012;Republican National Convention;Democratic National Convention">
<meta name="per" content="">
<meta name="org" content="Democratic Party;Republican Party">
<meta name="geo" content="">
<meta name="misspelling" content="">
<meta name="keywords" content="Presidential Election of 2012,Republican National Convention,Democratic National Convention,Democratic Party,Republican Party">
<meta name="description" content="A comparison of user statements on STEM before and after teh conference.">
<meta name="MEDIA_TEMPLATE_VERSION" content="200">
<meta name="asset_id" content="100000001765793">
<meta name="CG" content="us">
<meta name="SCG" content="politics">
<meta name="PT" content="Multimedia">
<meta name="PST" content="Interactive">
<meta property="og:type" content="article"/>
<meta property="og:title" content=""/>
<meta property="og:image" content="http://graphics8.nytimes.com//images/2012/09/06/us/politics/75.png"/>

	

<!-- <script type="text/javascript" src="https://static01.nyt.com/js/common.js"></script> -->

<script type="text/javascript" src="https://static01.nyt.com/js/common/screen/DropDown.js"></script>
<script type="text/javascript" src="https://static01.nyt.com/js/fileit.js"></script>
<script type="text/javascript" src="https://static01.nyt.com/js/util/tooltip.js"></script>

	
	
	   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sheetrock/1.1.4/dist/sheetrock.min.js"></script>

	
	
</head>
<body id="interactiveABC" class="interactiveABC">
<a name="top"></a>
<div id="shell">



<div id="main">
<div id="interactiveShell">
<div class="columnGroup firstColumnGroup">
<div class="ledeStory">
<div class="module insetHFullWidth">

    <div class="storyHeader">
<h6 class="dateline">
<span class="timestamp">UPDATED</span> March 7, 2018                    </h6>
<h1>At the Rockhurst STEAM/STEM/MEATS Conference</h1>
</div><!--close .storyHeader -->
<div class="storySummary">
<span class="summary">A comparison of user statements on STEM before and after the conference.</span>
</div><!--close .storySummary -->
</div><!--end .module insetHFullWidth -->
<div id="interactiveFreeFormMain">
{#<meta name="viewport" content="width=990">#}
<style>

@import url(https://static01.nyt.com/newsgraphics/2012/09/04/convention-speeches/ac823b240e99920e91945dbec49f35b268c09c38/index.css);

</style>
<!--[if lte IE 8]>
<img src="http://graphics8.nytimes.com/newsgraphics/2012/09/04/convention-speeches/ac823b240e99920e91945dbec49f35b268c09c38/fallback.png" alt="bubble chart">
<div class="g-error">To view an interactive version of this graphic, use a browser with SVG support, such as <a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.mozilla.org/en-US/firefox/">Firefox</a>, <a href="http://www.apple.com/safari/download/">Safari</a> or the latest <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home">Internet Explorer 9</a>.</div>
<![endif]-->
<!--[if gt IE 8]><!-->
<form id="g-form">
<input type="text" name="search" placeholder="Add word or phrase" tabindex="1"><button>+</button>
</form>
<div id="g-chart">
<div class="g-legend" style="position:absolute;width:970px;">
<div class="g-democrat g-arrow">Words favored<br>before coming to Rockhurst</div>
<div class="g-republican g-arrow">Words favored<br>after coming to Rockhurst</div>
<div class="g-overview">Number of mentions per 25,000 spoken words<br>by <span class="g-swatch g-democrat"></span>PRE and <span class="g-swatch g-republican"></span>POST</div>
</div>
<div class="g-notes">
<div class="g-note" style="left:20px;">
<b>Auto</b>
Democrats credited President Obama with the recovery of the auto industry after the 2009 bailout, while Republicans left the topic unmentioned.
</div>
<div class="g-note" style="left:252px;">
<b>Women</b>
Democrats used the word much more frequently, primarily in reference to women's health and equal pay.
</div>
<div class="g-note" style="left:505px;">
<b>Business</b>
Republicans were more likely to talk about businesses, emphasizing Mr. Romney's private-sector experience and plans to improve the economy.
</div>
<div class="g-note" style="left:737px;">
<b>Unemployment</b>
Many Republican speakers brought up the still-high unemployment rate and the number of Americans who remain jobless, while Democrats largely avoided the topic.
</div>
</div>
<div class="g-labels"></div>
<svg class="g-nodes" width="970" height="540">
<path class="g-note-arrow" id="g-arrow-auto" d="M58,425v-160"></path>
<path class="g-note-arrow" id="g-arrow-women" d="M308,425v-100"></path>
<path class="g-note-arrow" id="g-arrow-business" d="M630,425v-45l60,-60"></path>
<path class="g-note-arrow" id="g-arrow-unemployment" d="M885,425v-180"></path>
</svg>
</div>
<p><div class="g-body">
<div class="g-mentions g-democrat">
<h3 class="g-head g-hasnt-topic">
<span class="g-isnt-topic"><br>Excerpts from June</span>
<span class="g-is-topic"><span style="padding-left: 0.76em;">June People</span> mentioned <a>&hellip;</a><br><span class="g-count"></span> times per X words</span>
</h3>
<div class="g-divider"></div>
<div class="g-truncated">Due to a large number of mentions, only a sampling of excerpts are shown.</div>
</div>
<div class="g-mentions g-republican">
<h3 class="g-head g-hasnt-topic">
<span class="g-isnt-topic"><br>Excerpts from July</span>
<span class="g-is-topic">July People mentioned <a>&hellip;</a><br><span class="g-count"></span> times per X words</span>
</h3>
<div class="g-divider"></div>
<div class="g-truncated">Due to a large number of mentions, only a sampling of excerpts are shown.</div>
</div>
<br clear="all"><br>
</div>
<script src="d3.v2.min.js"></script>
<script src="index.js"></script>
<!--<![endif]-->
<!--pipeline: ac823b240e99920e91945dbec49f35b268c09c38 -->    </div><!--close main free form -->
<div class="insetHFullWidth">
<div id="interactiveFooter" class="opposingFloatControl wrap">
<div class="metaData element1">
<div class="module">
<span class="byline">By Greg Owsley, Wiliam Palin and I guess DJ? jk jk taken from http://www.nytimes.com/interactive/2012/09/06/us/politics/convention-word-counts.html</span>
<span class="refer feedback">
<span class="pipe">|</span>
<form name="interactivefeedback" method="post" enctype="application/x-www-form-urlencoded" action="/gst/emailus.html">
<input type="hidden" name="type" value="interactivefeedback" />
<input type="hidden" name="recipient" value="interactivefeedback" />
<input type="hidden" name="article" value="At the National Conventions, the Words They Used" />
<input type="hidden" name="url" value="http://www.nytimes.com/interactive/2012/09/06/us/politics/convention-word-counts.html" />
<a href="javascript:document.interactivefeedback.submit();">Send Feedback</a>
</form>
</span>
</div>
<div class="module">
<p class="credit">Source: GREG</p>
</div>
</div><!--close .metaData element1 -->
<div class="element2">
</div><!--close .element2 -->
</div><!--close #interactiveFooter -->
</div><!--close .insetHFullWidth -->
</div><!--close .ledeStory -->
</div><!--close .columnGroup -->
<div class="doubleRuleDivider insetHFullWidth"></div>
<div class="spanAB wrap">
<div class="abColumn">
<div class="subColumn-3 wrap noBackground">
<div class="columnGroup firstColumnGroup">




</div>






</div>
</div><!--close #page -->
</div><!--close #shell -->

		<table id="table"  style="display:None"; class="table table-condensed table-striped"></table>
		<table id="table2"  style="display:None"; class="table table-condensed table-striped"></table>

	</body>
		

<script type="text/javascript">
    // Define spreadsheet URL.
	
    var mySpreadsheet2 = "https://docs.google.com/spreadsheets/d/1P1UK0ZZ3sVJ4ZjRf0ZGdoLg0sCo1mNeprVduBPC4Fzo/edit#gid=0"
//         var mySpreadsheet2 = "https://docs.google.com/spreadsheets/d/1rdIpJp0t_IUVcT-GwuqFFJ9u3JFpWemgOrqfrjY-vB8/edit#gid=0"

	$('#table2').sheetrock({
      url: mySpreadsheet2,
      query: "select B,F",
      fetchSize: 10
    });
	
	
    var mySpreadsheet = "https://docs.google.com/spreadsheets/d/1rdIpJp0t_IUVcT-GwuqFFJ9u3JFpWemgOrqfrjY-vB8/edit#gid=0"
    $('#table').sheetrock({
      url: mySpreadsheet,
      query: "select B,F",
      fetchSize: 10
    });

  $(window).bind("load", function () {
    // Code here
      var table = document.getElementById('table')
      console.log(table.getElementsByTagName("td"))
      var tds = table.getElementsByTagName("td")
      var i = 0
      var xlist = []
       while (i <  tds.length) {

	       xlist.push(tds[i].innerText.toUpperCase()  + ": " + tds[i+1].innerText)
           i+=2
      }
        window.sessionStorage.setItem("datain", JSON.stringify(xlist))
	  
	  
      var table2 = document.getElementById('table2')
      console.log(table2.getElementsByTagName("td"))
      var tds2 = table2.getElementsByTagName("td")
      var i = 0
      var xlist2 = []
       while (i <  tds2.length) {

	       xlist2.push(tds2[i].innerText.toUpperCase()  + ": " + tds2[i+1].innerText)
           i+=2
      }
        window.sessionStorage.setItem("datain2", JSON.stringify(xlist2))

	  
	  

  });





    var data = {};

function getspeechone(){
    return JSON.parse(window.sessionStorage.getItem('datain'))


}
    function getspeechtwo(){
// 	    return ["HELLO PALIN: asdfasdfasdf asdf asdf "]
	return JSON.parse(window.sessionStorage.getItem('datain2'))

}


(function() {

    var x =  getspeechone()
    var y =  getspeechtwo()

    data.parties = [
    {
        name: "democrat",
        speeches: x
    },
    {
        name: "republican",
        speeches: y
    }
    ].map(party);

    data.speakers = {
        "JOSEPH KELLY": {
            name: "Al Green",
            title: "U.S. representative, Texas"
        },
        "BENJAMIN LEGG": {
            name: "Alex Schriver",
            title: "College Republican National Committee chairman"
        },
        "CADEN GABEL": {
            name: "Allyson Y. Schwartz",
            title: "U.S. representative, Pennsylvania"
        },
        "GREG OWSLEY": {
            name: "Andy Barr",
            title: "Congressional candidate, Kentucky"
        }
    };

    data.topics = [
   
	    

    {
        name: "technology",
        re: /\b(technology)\b/gi,
        x: 123,
        y: 181
    },
    {
        name: "Education",
        re: /\b(Education)\b/gi,
        x: 43,
        y: 203
    },
    {
        name: "Helpful",
        re: /\b(Helpful)\b/gi,
        x: 618,
        y: 201
    },
    {
        name: "Help",
        re: /\b(Help)\b/gi,
        x: 361,
        y: 256
    },
    {
        name: "Stem",
        re: /\b(Stem)\b/gi,
        x: 81,
        y: 235
    },
    
   
    {
        name: "projectors",
        re: /\b(projectors)\b/gi,
        x: 862,
        y: 217
    },
    {
        name: "instructors",
        re: /\b(instructors)\b/gi,
        x: 620,
        y: 339
    },
    {
        name: "classrooms",
        re: /\b(classrooms)\b/gi,
        x: 410,
        y: 340
    },
    {
        name: "Education",
        re: /\b(Education)\b/gi,
        x: 267,
        y: 218
    },
    
    {
        name: "curriculum",
        re: /\b(curriculum)\b/gi,
        x: 73,
        y: 206
    },
    {
        name: "concepts",
        re: /\bconcepts\b/gi,
        x: 721,
        y: 230
    },
    
    {
        name: "practical",
        re: /\b(practical)\b/gi,
        x: 650,
        y: 246
    },
    {
        name: "applications",
        re: /\b(applications)\b/gi,
        x: 401,
        y: 113
    },
    {
        name: "learning",
        re: /\b(learning)\b/gi,
        x: 214,
        y: 248
    },
    
    {
        name: "students",
        re: /\b(students)\b/gi,
        x: 139,
        y: 177
    }
    
    ].map(topic);

    data.topic = function(name) {
        var t = topic({
            name: name,
            re: new RegExp("\\b(" + d3.requote(name) + ")\\b", "gi")
        }, data.topics.length);
        data.topics.push(t);
        return t;
    };

    function party(party) {
        party.speeches = party.speeches.map(speech);
        party.sections = sections(party.speeches);
        party.wordCount = d3.sum(party.sections, function(d) {
            return countWords(d.speech.text.substring(d.i, d.j));
        });
        return party;
    }

    function speech(text, i) {
        return {
            text: text,
            id: i
        };
    }

    function sections(speeches) {
        var speakerRe = /(?:\n|^)([A-Z\.()\- ]+): /g,
            sections = [];

        speeches.forEach(function(speech) {
            var speakerName = "AUDIENCE",
                match,
                i = speakerRe.lastIndex = 0;
            while (match = speakerRe.exec(speech.text)) {
                if (match.index > i)
                    sections.push({
                        speaker: speakerName,
                        speech: speech,
                        i: i,
                        j: match.index
                    });
                speakerName = match[1];
                i = speakerRe.lastIndex;
            }
            sections.push({
                speaker: speakerName,
                speech: speech,
                i: i,
                j: speech.text.length
            });
        });

        return sections.filter(function(d) {
            return !/^AUDIENCE\b/.test(d.speaker);
        });
    }

    function topic(topic, i) {
        topic.id = i;
        topic.count = 0;
        topic.cx = topic.x;
        topic.cy = topic.y;

        topic.parties = data.parties.map(function(party) {
            var count = 0,
                mentions = [];

            party.sections.forEach(function(section) {
                var text = section.speech.text.substring(section.i, section.j),
                    match;
                topic.re.lastIndex = 0;
                while (match = topic.re.exec(text)) {
                    ++count;
                    mentions.push({
                        topic: topic,
                        section: section,
                        i: section.i + match.index,
                        j: section.i + topic.re.lastIndex
                    });
                }
            });

            topic.count += count = count / party.wordCount * 25e3;
            return {
                count: count,
                mentions: mentions
            };
        });

        return topic;
    }

    function countWords(text) {
        return text.split(/\s+/g)
        .filter(function(d) {
            return d !== "—";
        })
        .length;
    }

})();

(function() {

    var width = 970,
        height = 540;

    var collisionPadding = 4,
        clipPadding = 4,
        minRadius = 16,
        // minimum collision radius
        maxRadius = 65,
        // also determines collision search radius
        maxMentions = 100,
        // don't show full transcripts
        activeTopic; // currently-displayed topic

    var formatShortCount = d3.format(",.0f"),
        formatLongCount = d3.format(".1f"),
        formatCount = function(d) {
            return (d < 10 ? formatLongCount : formatShortCount)(d);
        };

    var r = d3.scale.sqrt()
    .domain([0, d3.max(data.topics, function(d) {
        return d.count;
    })])
    .range([0, maxRadius]);

    var force = d3.layout.force()
    .charge(0)
    .size([width, height - 80])
    .on("tick", tick);

    var node = d3.select(".g-nodes").selectAll(".g-node"),
        label = d3.select(".g-labels").selectAll(".g-label"),
        arrow = d3.select(".g-nodes").selectAll(".g-note-arrow");

    d3.select(".g-nodes").append("rect")
    .attr("class", "g-overlay")
    .attr("width", width)
    .attr("height", height)
    .on("click", clear);

    d3.select(window)
    .on("hashchange", hashchange);

    d3.select("#g-form")
    .on("submit", submit);

    updateTopics(data.topics);
    hashchange();

    // Update the known topics.
    function updateTopics(topics) {
        topics.forEach(function(d) {
            d.r = r(d.count);
            d.cr = Math.max(minRadius, d.r);
            d.k = fraction(d.parties[0].count, d.parties[1].count);
            if (isNaN(d.k))
                d.k = .5;
            if (isNaN(d.x))
                d.x = (1 - d.k) * width + Math.random();
            d.bias = .5 - Math.max(.1, Math.min(.9, d.k));
        });
        force.nodes(data.topics = topics).start();
        updateNodes();
        updateLabels();
        updateArrows();
        tick({
            alpha: 0
        }); // synchronous update
    }

    // Update the displayed nodes.
    function updateNodes() {
        node = node.data(data.topics, function(d) {
            return d.name;
        });

        node.exit().remove();

        var nodeEnter = node.enter().append("a")
        .attr("class", "g-node")
        .attr("xlink:href", function(d) {
            return "#" + encodeURIComponent(d.name);
        })
        .call(force.drag)
        .call(linkTopic);

        var democratEnter = nodeEnter.append("g")
        .attr("class", "g-democrat");

        democratEnter.append("clipPath")
        .attr("id", function(d) {
            return "g-clip-democrat-" + d.id;
        })
        .append("rect");

        democratEnter.append("circle");

        var republicanEnter = nodeEnter.append("g")
        .attr("class", "g-republican");

        republicanEnter.append("clipPath")
        .attr("id", function(d) {
            return "g-clip-republican-" + d.id;
        })
        .append("rect");

        republicanEnter.append("circle");

        nodeEnter.append("line")
        .attr("class", "g-split");

        node.selectAll("rect")
        .attr("y", function(d) {
            return -d.r - clipPadding;
        })
        .attr("height", function(d) {
            return 2 * d.r + 2 * clipPadding;
        });

        node.select(".g-democrat rect")
        .style("display", function(d) {
            return d.k > 0 ? null : "none"
        })
        .attr("x", function(d) {
            return -d.r - clipPadding;
        })
        .attr("width", function(d) {
            return 2 * d.r * d.k + clipPadding;
        });

        node.select(".g-republican rect")
        .style("display", function(d) {
            return d.k < 1 ? null : "none"
        })
        .attr("x", function(d) {
            return -d.r + 2 * d.r * d.k;
        })
        .attr("width", function(d) {
            return 2 * d.r;
        });

        node.select(".g-democrat circle")
        .attr("clip-path", function(d) {
            return d.k < 1 ? "url(#g-clip-democrat-" + d.id + ")" : null;
        });

        node.select(".g-republican circle")
        .attr("clip-path", function(d) {
            return d.k > 0 ? "url(#g-clip-republican-" + d.id + ")" : null;
        });

        node.select(".g-split")
        .attr("x1", function(d) {
            return -d.r + 2 * d.r * d.k;
        })
        .attr("y1", function(d) {
            return -Math.sqrt(d.r * d.r - Math.pow(-d.r + 2 * d.r * d.k, 2));
        })
        .attr("x2", function(d) {
            return -d.r + 2 * d.r * d.k;
        })
        .attr("y2", function(d) {
            return Math.sqrt(d.r * d.r - Math.pow(-d.r + 2 * d.r * d.k, 2));
        });

        node.selectAll("circle")
        .attr("r", function(d) {
            return r(d.count);
        });
    }

    // Update the displayed node labels.
    function updateLabels() {
        label = label.data(data.topics, function(d) {
            return d.name;
        });

        label.exit().remove();

        var labelEnter = label.enter().append("a")
        .attr("class", "g-label")
        .attr("href", function(d) {
            return "#" + encodeURIComponent(d.name);
        })
        .call(force.drag)
        .call(linkTopic);

        labelEnter.append("div")
        .attr("class", "g-name")
        .text(function(d) {
            return d.name;
        });

        labelEnter.append("div")
        .attr("class", "g-value");

        label
        .style("font-size", function(d) {
            return Math.max(8, d.r / 2) + "px";
        })
        .style("width", function(d) {
            return d.r * 2.5 + "px";
        });

        // Create a temporary span to compute the true text width.
        label.append("span")
        .text(function(d) {
            return d.name;
        })
        .each(function(d) {
            d.dx = Math.max(d.r * 2.5, this.getBoundingClientRect().width);
        })
        .remove();

        label
        .style("width", function(d) {
            return d.dx + "px";
        })
        .select(".g-value")
        .text(function(d) {
            return formatShortCount(d.parties[0].count) + " - " + formatShortCount(d.parties[1].count);
        });

        // Compute the height of labels when wrapped.
        label.each(function(d) {
            d.dy = this.getBoundingClientRect().height;
        });
    }

    // Update the active topic.
    function updateActiveTopic(topic) {
        d3.selectAll(".g-head").attr("class", topic ? "g-head g-has-topic" : "g-head g-hasnt-topic");
        if (activeTopic = topic) {
            node.classed("g-selected", function(d) {
                return d === topic;
            });
            updateMentions(findMentions(topic));
            d3.selectAll(".g-head a").text(topic.name);
            d3.select(".g-democrat .g-head span.g-count").text(formatCount(topic.parties[0].count));
            d3.select(".g-republican .g-head span.g-count").text(formatCount(topic.parties[1].count));
        } else {
            node.classed("g-selected", false);
            updateMentions(sampleMentions());
            d3.selectAll(".g-head a").text("various topics");
            d3.selectAll(".g-head span.g-count").text("some number of");
        }
    }

    // Update displayed excerpts.
    function updateMentions(mentions) {
        var column = d3.selectAll(".g-mentions")
        .data(mentions);

        column.select(".g-truncated")
        .style("display", function(d) {
            return d.truncated ? "block" : null;
        });

        var mention = column.selectAll(".g-mention")
        .data(groupMentionsBySpeaker, function(d) {
            return d.key;
        });

        mention.exit().remove();

        mention.selectAll("p")
        .remove();

        var mentionEnter = mention.enter().insert("div", ".g-truncated")
        .attr("class", "g-mention");

        mentionEnter.append("div")
        .attr("class", "g-speaker")
        .text(function(d) {
            var s = data.speakers[d.key];
            return s ? s.name : d.key;
        });

        mentionEnter.append("div")
        .attr("class", "g-speaker-title")
        .text(function(d) {
            var s = data.speakers[d.key];
            return s && s.title;
        });

        mention
        .sort(function(a, b) {
            return b.values.length - a.values.length;
        });

        var p = mention.selectAll("p")
        .data(function(d) {
            return d.values;
        })
        .enter().append("p")
        .html(function(d) {
            return d.section.speech.text.substring(d.start, d.end).replace(d.topic.re, "<a>$1</a>");
        });

        if (activeTopic) {
            p.attr("class", "g-hover");
        } else {
            p.each(function(d) {
                d3.select(this).selectAll("a")
                .datum(d.topic)
                .attr("href", "#" + encodeURIComponent(d.topic.name))
                .call(linkTopic);
            });
        }
    }

    // Bind the arrow path elements with their associated topic.
    function updateArrows() {
        arrow = arrow.data(
        data.topics.filter(function(d) {
            return d.arrow;
        }),
        function(d) {
            return this.id ? this.id.substring(8) : d.arrow;
        });
    }

    // Return a random sample of mentions per party, one per topic.
    // Mentions are returned in chronological order.
    function sampleMentions() {
        return data.parties.map(function(party, i) {
            return data.topics
            .map(function(d) {
                return d.parties[i].mentions;
            })
            .filter(function(d) {
                return d.length;
            })
            .map(function(d) {
                return d[Math.floor(Math.random() * d.length)];
            })
            .sort(orderMentions);
        });
    }

    // Return displayable mentions per party for the specified topic.
    // If too many, a random sample of matching mentions is returned.
    // Mentions are returned in chronological order.
    function findMentions(topic) {
        return data.parties.map(function(party, i) {
            var mentions = topic.parties[i].mentions;
            if (mentions.length > maxMentions) {
                shuffle(mentions).length = maxMentions;
                mentions.sort(orderMentions);
                mentions.truncated = true;
            }
            return mentions;
        });
    }

    // Group mentions by speaker, collapse overlapping excerpts.
    function groupMentionsBySpeaker(mentions) {
        return d3.nest()
        .key(function(d) {
            return d.section.speaker;
        })
        .rollup(collapseMentions)
        .entries(mentions);
    }

    // Given an array of mentions, computes the start and end point of the context
    // excerpt, and then collapses any overlapping excerpts.
    function collapseMentions(mentions) {
        var sentenceRe = /([!?.)]+)\s+/g,
            // sentence splitting requires NLP
            i,
            n = mentions.length,
            d0,
            d1;

        // First compute the excerpt contexts.
        for (i = 0; i < n; ++i) {
            d0 = mentions[i];
            d0.start = excerptStart(d0);
            d0.end = excerptEnd(d0);
        }

        // Then collapse any overlapping excerpts (from the same speech).
        for (i = 1, d1 = mentions[0]; i < n; ++i) {
            d0 = d1;
            d1 = mentions[i];
            if (d1.section.speech.id === d0.section.speech.id
            && d1.start >= d0.start
            && d1.start < d0.end) {
                d1.start = -1;
                d0.end = d1.end;
                d1 = d0;
            }
        }

        // Returns the start index of the excerpt for the specified mention.
        function excerptStart(mention) {
            var i = sentenceRe.lastIndex = Math.max(mention.section.i, mention.i - 80),
                match;
            while (match = sentenceRe.exec(mention.section.speech.text)) {
                if (match.index < mention.i - 20)
                    return match.index + match[0].length;
                if (i <= mention.section.i)
                    break;
                sentenceRe.lastIndex = i = Math.max(mention.section.i, i - 20);
            }
            return mention.section.i;
        }

        // Returns the end index of the excerpt for the specified mention.
        function excerptEnd(mention) {
            var i = mention.section.j,
                match;
            sentenceRe.lastIndex = mention.j + 40;
            match = sentenceRe.exec(mention.section.speech.text);
            return match ? Math.min(match.index + match[1].length, i) : i;
        }

        return mentions.filter(function(d) {
            return d.start >= 0;
        });
    }

    // Orders mentions chronologically: by speech and position within speech.
    function orderMentions(a, b) {
        return a.section.speech.id - b.section.speech.id || a.i - b.i;
    }

    // Assign event handlers to topic links.
    function linkTopic(a) {
        a.on("click", click)
        .on("mouseover", mouseover)
        .on("mouseout", mouseout);
    }

    // Returns the topic matching the specified name, approximately.
    // If no matching topic is found, returns undefined.
    function findTopic(name) {
        for (var i = 0, n = data.topics.length, t; i < n; ++i) {
            if ((t = data.topics[i]).name === name || new RegExp("^" + (t = data.topics[i]).re.source + "$", "i").test(name)) {
                return t;
            }
        }
    }

    // Returns the topic matching the specified name, approximately.
    // If no matching topic is found, a new one is created.
    function findOrAddTopic(name) {
        var topic = findTopic(name);
        if (!topic) {
            topic = data.topic(name.substring(0, 1).toUpperCase() + name.substring(1));
            topic.y = 0;
            updateTopics(data.topics);
        }
        return topic;
    }

    // Simulate forces and update node and label positions on tick.
    function tick(e) {
        node
        .each(bias(e.alpha * 10))
        .each(collide(.5))
        .attr("transform", function(d) {
            return "translate(" + d.x + "," + d.y + ")";
        });

        label
        .style("left", function(d) {
            return (d.x - d.dx / 2) + "px";
        })
        .style("top", function(d) {
            return (d.y - d.dy / 2) + "px";
        });

        arrow.style("stroke-opacity", function(d) {
            var dx = d.x - d.cx,
                dy = d.y - d.cy;
            return dx * dx + dy * dy < d.r * d.r ? 1 : 0;
        });
    }

    // A left-right bias causing topics to orient by party preference.
    function bias(alpha) {
        return function(d) {
            d.x += d.bias * alpha;
        };
    }

    // Resolve collisions between nodes.
    function collide(alpha) {
        var q = d3.geom.quadtree(data.topics);
        return function(d) {
            var r = d.cr + maxRadius + collisionPadding,
                nx1 = d.x - r,
                nx2 = d.x + r,
                ny1 = d.y - r,
                ny2 = d.y + r;
            q.visit(function(quad, x1, y1, x2, y2) {
                if (quad.point && (quad.point !== d) && d.other !== quad.point && d !== quad.point.other) {
                    var x = d.x - quad.point.x,
                        y = d.y - quad.point.y,
                        l = Math.sqrt(x * x + y * y),
                        r = d.cr + quad.point.r + collisionPadding;
                    if (l < r) {
                        l = (l - r) / l * alpha;
                        d.x -= x *= l;
                        d.y -= y *= l;
                        quad.point.x += x;
                        quad.point.y += y;
                    }
                }
                return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
            });
        };
    }

    // Fisher–Yates shuffle.
    function shuffle(array) {
        var m = array.length,
            t,
            i;
        while (m) {
            i = Math.floor(Math.random() * m--);
            t = array[m];
            array[m] = array[i];
            array[i] = t;
        }
        return array;
    }

    // Given two quantities a and b, returns the fraction to split the circle a + b.
    function fraction(a, b) {
        var k = a / (a + b);
        if (k > 0 && k < 1) {
            var t0,
                t1 = Math.pow(12 * k * Math.PI, 1 / 3);
            for (var i = 0; i < 10; ++i) {
                // Solve for theta numerically.
                t0 = t1;
                t1 = (Math.sin(t0) - t0 * Math.cos(t0) + 2 * k * Math.PI) / (1 - Math.cos(t0));
            }
            k = (1 - Math.cos(t1 / 2)) / 2;
        }
        return k;
    }

    // Update the active topic on hashchange, perhaps creating a new topic.
    function hashchange() {
        var name = decodeURIComponent(location.hash.substring(1)).trim();
        updateActiveTopic(name && name != "!" ? findOrAddTopic(name) : null);
    }

    // Trigger a hashchange on submit.
    function submit() {
        var name = this.search.value.trim();
        location.hash = name ? encodeURIComponent(name) : "!";
        this.search.value = "";
        d3.event.preventDefault();
    }

    // Clear the active topic when clicking on the chart background.
    function clear() {
        location.replace("#!");
    }

    // Rather than flood the browser history, use location.replace.
    function click(d) {
        location.replace("#" + encodeURIComponent(d === activeTopic ? "!" : d.name));
        d3.event.preventDefault();
    }

    // When hovering the label, highlight the associated node and vice versa.
    // When no topic is active, also cross-highlight with any mentions in excerpts.
    function mouseover(d) {
        node.classed("g-hover", function(p) {
            return p === d;
        });
        if (!activeTopic)
            d3.selectAll(".g-mention p").classed("g-hover", function(p) {
                return p.topic === d;
            });
    }

    // When hovering the label, highlight the associated node and vice versa.
    // When no topic is active, also cross-highlight with any mentions in excerpts.
    function mouseout(d) {
        node.classed("g-hover", false);
        if (!activeTopic)
            d3.selectAll(".g-mention p").classed("g-hover", false);
    }

})();




</script>

</html>


